# File Structure - Vite Idiomatic Organization

This document explains the file structure and why it's organized this way.

## Directory Structure

```
frontend/
├── src/
│   ├── lib/
│   │   └── gfx.js              # Source: WebGPU/WASI bindings (source code)
│   ├── wasm/
│   │   └── generated/          # Generated: Output from jco transpile
│   │       ├── triangle.js      # Transpiled JavaScript bindings
│   │       ├── triangle.d.ts    # TypeScript definitions
│   │       ├── triangle.core.wasm
│   │       ├── gfx.js           # Copied from src/lib/gfx.js (for relative imports)
│   │       └── interfaces/      # Generated interface definitions
│   ├── App.tsx                  # Uses @wasm/triangle.js
│   └── ...
├── public/                      # Static assets (no gfx.js here anymore)
└── ...
```

## Why This Structure?

### 1. **Source Files in `src/lib/`**
- `gfx.js` is **source code**, not a static asset
- It's part of the application logic (WebGPU bindings)
- Should be version controlled and editable
- Located in `src/` so Vite can process it if needed

### 2. **Generated Files in `src/wasm/generated/`**
- All files generated by `jco transpile` go here
- Clear separation: source vs generated
- Follows Vite conventions (generated files in `src/`)
- Added to `.gitignore` (regenerated on each build)

### 3. **Why Copy `gfx.js` to Generated Directory?**
- The generated `triangle.js` imports `./gfx.js` (relative import)
- `jco transpile` mappings use `./gfx.js` relative to output directory
- So `gfx.js` must be in the same directory as generated files
- This is a **build-time copy**, not duplication in source

### 4. **No More `examples/static/`**
- This was a legacy directory name from another PoC
- Replaced with a more descriptive, Vite-idiomatic path
- `src/wasm/generated/` clearly indicates:
  - It's in the source tree (`src/`)
  - It's WASM-related (`wasm/`)
  - It's generated code (`generated/`)

### 5. **No More `public/gfx.js`**
- `public/` is for static assets served as-is (images, fonts, etc.)
- `gfx.js` is source code that needs to be processed
- Moved to `src/lib/` where it belongs

## Import Paths

### Using the Alias
```typescript
import { run as wasiCliRun } from '@wasm/triangle.js'
```

The `@wasm` alias resolves to `src/wasm/generated/`, configured in:
- `vite.config.ts` (Vite alias)
- `tsconfig.app.json` (TypeScript paths)

## Build Process

1. **Plugin runs `jco transpile`**:
   - Outputs to `src/wasm/generated/`
   - Copies `src/lib/gfx.js` → `src/wasm/generated/gfx.js`

2. **Vite processes imports**:
   - `@wasm/triangle.js` → `src/wasm/generated/triangle.js`
   - Generated code imports `./gfx.js` (relative, works!)

3. **No duplication**:
   - Single source: `src/lib/gfx.js`
   - Build-time copy to generated directory (for relative imports)
   - Clean separation of concerns

## Benefits

✅ **Vite-idiomatic**: Follows standard Vite project structure  
✅ **Clear separation**: Source vs generated files  
✅ **No duplication**: Single source of truth for `gfx.js`  
✅ **Type-safe**: TypeScript paths configured correctly  
✅ **Maintainable**: Clear organization, easy to understand  
✅ **Git-friendly**: Generated files in `.gitignore`

