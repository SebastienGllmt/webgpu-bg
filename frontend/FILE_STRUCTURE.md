# File Structure - Vite Idiomatic Organization

This document explains the file structure and why it's organized this way.

## Directory Structure

```
frontend/
├── src/
│   ├── lib/
│   │   └── gfx.js              # Source: WebGPU/WASI bindings (source code)
│   ├── wasm/
│   │   └── generated/          # Generated: Output from jco transpile
│   │       ├── triangle.js      # Transpiled JavaScript bindings (imports ../../lib/gfx.js)
│   │       ├── triangle.d.ts    # TypeScript definitions
│   │       ├── triangle.core.wasm
│   │       └── interfaces/      # Generated interface definitions
│   ├── App.tsx                  # Uses @wasm/triangle.js
│   └── ...
├── public/                      # Static assets
└── ...
```

## Why This Structure?

### 1. **Source Files in `src/lib/`**
- `gfx.js` is **source code**, not a static asset
- It's part of the application logic (WebGPU bindings)
- Should be version controlled and editable
- Located in `src/` so Vite can process it if needed

### 2. **Generated Files in `src/wasm/generated/`**
- All files generated by `jco transpile` go here
- Clear separation: source vs generated
- Follows Vite conventions (generated files in `src/`)
- Added to `.gitignore` (regenerated on each build)

### 3. **Direct Reference to Source `gfx.js`**
- The generated `triangle.js` imports `../../lib/gfx.js` (relative import)
- From `src/wasm/generated/` to `src/lib/` requires going up two levels
- `jco transpile` mappings use `../../lib/gfx.js` to reference the source file
- No copying needed - direct reference to source location
- Vite resolves the import path correctly at build time

### 4. **No More `examples/static/`**
- This was a legacy directory name from another PoC
- Replaced with a more descriptive, Vite-idiomatic path
- `src/wasm/generated/` clearly indicates:
  - It's in the source tree (`src/`)
  - It's WASM-related (`wasm/`)
  - It's generated code (`generated/`)

### 5. **No More `public/gfx.js`**
- `public/` is for static assets served as-is (images, fonts, etc.)
- `gfx.js` is source code that needs to be processed
- Moved to `src/lib/` where it belongs

## Import Paths

### Using the Alias
```typescript
import { run as wasiCliRun } from '@wasm/triangle.js'
```

The `@wasm` alias resolves to `src/wasm/generated/`, configured in:
- `vite.config.ts` (Vite alias)
- `tsconfig.app.json` (TypeScript paths)

## Build Process

1. **Plugin runs `jco transpile`**:
   - Outputs to `src/wasm/generated/`
   - Maps WASI interfaces to `../lib/gfx.js` (relative path to source)

2. **Vite processes imports**:
   - `@wasm/triangle.js` → `src/wasm/generated/triangle.js`
   - Generated code imports `../../lib/gfx.js` (relative path, resolved by Vite)

3. **No duplication**:
   - Single source: `src/lib/gfx.js`
   - Direct reference from generated code (no copying)
   - Clean separation of concerns

## Benefits

✅ **Vite-idiomatic**: Follows standard Vite project structure  
✅ **Clear separation**: Source vs generated files  
✅ **No duplication**: Single source of truth, direct reference (no copying)  
✅ **Type-safe**: TypeScript paths configured correctly  
✅ **Maintainable**: Clear organization, easy to understand  
✅ **Git-friendly**: Generated files in `.gitignore`

